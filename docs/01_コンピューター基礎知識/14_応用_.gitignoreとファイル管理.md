# .gitignoreとファイル管理

## 🎯 この章で学ぶこと

- **`.gitignore`** の役割と重要性
- **Gitにアップロードすべきファイル・してはいけないファイル**の判断基準
- **実践的な`.gitignore`の書き方**と運用方法
- **よくある問題**とその解決方法

**重要度**: 🔴 **応用** - Git使用時に必須の知識

---

## 🤔 なぜ.gitignoreが必要なのか？

### 問題のあるシナリオ

あなたがプログラミングプロジェクトを開発して、Gitリポジトリに全てのファイルをアップロードしたとします：

```
my-project/
├── app.py                    # ✅ 必要
├── requirements.txt          # ✅ 必要
├── README.md                # ✅ 必要
├── __pycache__/             # ❌ 不要（自動生成）
│   ├── app.cpython-39.pyc
│   └── utils.cpython-39.pyc
├── venv/                    # ❌ 不要（仮想環境）
│   ├── lib/
│   ├── Scripts/
│   └── ...（数千ファイル）
├── .vscode/                 # ❌ 個人設定
│   └── settings.json
├── config.py                # ❌ 機密情報
│   └── DATABASE_PASSWORD = "secret123"
└── temp_notes.txt           # ❌ 個人メモ
```

### 生じる問題

#### **1. 🚨 セキュリティリスク**
```python
# config.py（機密情報が含まれる）
DATABASE_PASSWORD = "mySecretPassword123"
API_KEY = "sk-1234567890abcdef"
SECRET_KEY = "production-secret-key"
```
👆 **これをGitHubに公開すると、全世界に機密情報が漏洩！**

#### **2. 📦 リポジトリサイズの肥大化**
```
通常のプロジェクト: 100KB
venv/フォルダ: 50MB
node_modules/: 200MB
合計: 250MB （251倍！）
```

#### **3. 👥 チーム開発での競合**
```
田中さんのVS Code設定: .vscode/settings.json
佐藤さんのVS Code設定: .vscode/settings.json
→ 毎回衝突！
```

#### **4. 🚫 不要なファイルでの混乱**
```
git status
Changes not staged for commit:
  modified: __pycache__/app.cpython-39.pyc
  modified: __pycache__/utils.cpython-39.pyc
  modified: .DS_Store
  modified: Thumbs.db
  modified: temp1.txt
  modified: temp2.txt
  modified: 実験用ファイル.py
```
👆 **本当に必要な変更が見つからない！**

---

## 🛡️ .gitignoreファイルとは？

### 基本概念

**`.gitignore`** は「**Gitに追跡してほしくないファイル・フォルダを指定するファイル**」です。

```
.gitignore ファイルに書かれたパターンにマッチするファイル
→ Gitが自動的に無視する
→ git add . をしても追加されない
→ git status にも表示されない
```

### 実際の.gitignoreファイル例

```gitignore
# Python関連
__pycache__/
*.py[cod]
*.so
venv/
.env

# IDE関連
.vscode/
.idea/
*.swp

# OS関連
.DS_Store
Thumbs.db

# 一時ファイル
*.tmp
*.log
temp_*
```

---

## 📋 アップロードすべき vs してはいけないファイル

### ✅ Gitにアップロードすべきファイル

#### **1. ソースコード**
```
✅ app.py              # メインプログラム
✅ utils.py            # 共通関数  
✅ main.js             # JavaScript
✅ style.css           # スタイルシート
✅ index.html          # HTMLファイル
```

#### **2. 設定ファイル（機密情報を除く）**
```
✅ requirements.txt    # パッケージ依存関係
✅ package.json        # Node.js依存関係
✅ Dockerfile          # コンテナ設定
✅ .gitignore         # Git除外設定
```

#### **3. ドキュメント**
```
✅ README.md          # プロジェクト説明
✅ docs/              # 技術文書
✅ LICENSE            # ライセンス
✅ CHANGELOG.md       # 変更履歴
```

#### **4. 設定テンプレート**
```
✅ config.example.py   # 設定の例（機密情報なし）
✅ .env.example       # 環境変数の例
✅ docker-compose.yml # 開発環境設定
```

### ❌ Gitにアップロードしてはいけないファイル

#### **1. 🔐 機密情報**
```
❌ .env               # 環境変数（パスワード等）
❌ config.py          # 本番用設定
❌ secrets.json       # APIキー
❌ *.pem             # 秘密鍵
❌ database.db       # 本番データベース
```

#### **2. 🤖 自動生成ファイル**
```
❌ __pycache__/       # Pythonバイトコード
❌ *.pyc             # コンパイル済みPython
❌ node_modules/     # Node.js依存関係
❌ dist/             # ビルド結果
❌ build/            # コンパイル結果
```

#### **3. 🏠 仮想環境・依存関係**
```
❌ venv/             # Python仮想環境
❌ .venv/            # Python仮想環境
❌ env/              # Python仮想環境
❌ virtualenv/       # Python仮想環境
```

#### **4. 💻 IDE・エディタ設定**
```
❌ .vscode/          # VS Code設定
❌ .idea/            # IntelliJ設定
❌ *.swp             # Vim一時ファイル
❌ *~                # Emacs一時ファイル
```

#### **5. 🖥️ OS固有ファイル**
```
❌ .DS_Store         # macOS
❌ Thumbs.db         # Windows
❌ desktop.ini       # Windows
❌ .Trashes          # macOS
```

#### **6. 📝 個人的ファイル**
```
❌ メモ.txt           # 個人メモ
❌ todo.md           # 個人TODO
❌ 実験用.py          # テスト用ファイル
❌ debug_*           # デバッグ用
❌ temp_*            # 一時ファイル
```

---

## 📝 .gitignoreの書き方

### 基本構文

#### **1. ファイル名指定**
```gitignore
# 特定のファイル
config.py
secret.txt
database.db
```

#### **2. フォルダ指定**
```gitignore
# フォルダ全体（最後に/をつける）
__pycache__/
node_modules/
.vscode/
```

#### **3. ワイルドカード**
```gitignore
# 拡張子で指定
*.log          # すべての.logファイル
*.tmp          # すべての.tmpファイル
*.pyc          # すべての.pycファイル

# パターンマッチ
temp_*         # temp_で始まるファイル
*_backup       # _backupで終わるファイル
debug_*.py     # debug_で始まる.pyファイル
```

#### **4. 除外の例外**
```gitignore
# すべての.logファイルを無視
*.log

# でもimportant.logは追跡する
!important.log
```

#### **5. パス指定**
```gitignore
# プロジェクトルートの特定ファイルのみ
/config.py

# すべてのサブディレクトリの特定ファイル
**/config.py

# 特定のディレクトリ内のすべて
docs/temp/
```

#### **6. コメント**
```gitignore
# これはコメント行
# Python関連の除外設定
__pycache__/   # バイトコードキャッシュ
*.pyc          # コンパイル済みファイル
```

### 実践例

#### **Pythonプロジェクト用**
```gitignore
# Byte-compiled / optimized / DLL files
__pycache__/
*.py[cod]
*$py.class

# 仮想環境
venv/
.venv/
env/

# 機密情報
.env
config.py

# IDE
.vscode/
.idea/

# OS
.DS_Store
Thumbs.db

# 個人用
notes.txt
todo.md
temp_*
```

#### **Node.js プロジェクト用**
```gitignore
# 依存関係
node_modules/

# ログ
npm-debug.log*
yarn-debug.log*
yarn-error.log*

# 環境変数
.env
.env.local
.env.production

# ビルド結果
dist/
build/

# OS
.DS_Store
Thumbs.db
```

#### **Web開発プロジェクト用**
```gitIgnore
# 依存関係
node_modules/
bower_components/

# ビルド結果
dist/
build/
*.min.css
*.min.js

# 設定
.env
config.json

# 一時ファイル
*.log
*.tmp

# OS・IDE
.DS_Store
Thumbs.db
.vscode/
.idea/
```

---

## 🔧 実践的な運用方法

### 1. プロジェクト開始時の設定

#### **ステップ1: .gitignoreファイル作成**
```bash
# プロジェクトルートで実行
touch .gitignore

# Windowsの場合
echo. > .gitignore
```

#### **ステップ2: テンプレートの活用**
**GitHub提供のテンプレート**: https://github.com/github/gitignore

```bash
# Python用テンプレートをダウンロード
curl -o .gitignore https://raw.githubusercontent.com/github/gitignore/main/Python.gitignore
```

#### **ステップ3: カスタマイズ**
```gitignore
# === プロジェクト固有の設定を追加 ===

# 個人的なファイル
my_notes.md
temp_experiments/
sandbox/

# プロジェクト固有の設定
local_config.py
test_data/
```

### 2. 既存プロジェクトでの対応

#### **問題: すでに不要ファイルがコミットされている**

```bash
# 現在の状況確認
git status
# → __pycache__/ や .DS_Store がtracked状態

# 解決手順
# 1. .gitignoreに追加
echo "__pycache__/" >> .gitignore
echo ".DS_Store" >> .gitignore

# 2. Gitの追跡から除外（ファイルは残す）
git rm -r --cached __pycache__/
git rm --cached .DS_Store

# 3. 変更をコミット
git add .gitignore
git commit -m "Add .gitignore and remove tracked unnecessary files"
```

### 3. チーム開発での運用

#### **共通.gitignore設定**
```gitignore
# === 必須（全員が同じ設定） ===
# 機密情報
.env
secrets/

# 自動生成
__pycache__/
node_modules/

# === 推奨（個人で調整可能） ===
# IDE設定は個人用.gitignoreで管理
# .vscode/settings.json
```

#### **個人用.gitignore**
```bash
# グローバル.gitignoreの設定
git config --global core.excludesfile ~/.gitignore_global

# ~/.gitignore_global に個人設定を記述
echo ".vscode/" >> ~/.gitignore_global
echo ".idea/" >> ~/.gitignore_global
echo "*.swp" >> ~/.gitignore_global
```

---

## 🚨 よくある問題とトラブルシューティング

### 問題1: .gitignoreが効かない

#### **症状**
```bash
git status
# .gitignoreに書いたファイルが表示される
```

#### **原因と解決**
```bash
# 原因: すでにGitで追跡されているファイル
# 解決: 一度追跡から外す

git rm --cached filename
git commit -m "Remove tracked file that should be ignored"
```

### 問題2: 機密情報を間違えてコミット

#### **症状**
```bash
# .envファイルにパスワードが...
git log --oneline
# abc1234 Add .env file  # ← これが問題
```

#### **解決方法**
```bash
# 方法1: 最新コミットのみの場合
git reset --soft HEAD~1
git rm --cached .env
echo ".env" >> .gitignore
git add .gitignore
git commit -m "Add .gitignore and protect sensitive information"

# 方法2: 履歴全体から削除（強力）
git filter-branch --force --index-filter \
'git rm --cached --ignore-unmatch .env' \
--prune-empty --tag-name-filter cat -- --all
```

### 問題3: 大量のファイルが無視されすぎ

#### **症状**
```bash
git status
# 必要なファイルが表示されない
```

#### **確認方法**
```bash
# 特定ファイルが無視されているか確認
git check-ignore -v filename

# 例: config.py が無視されている理由を確認
git check-ignore -v config.py
# .gitignore:15:*.py    config.py
```

#### **解決**
```gitignore
# 一般的なパターンで除外している場合
*.py

# 特定ファイルを例外として追加
!config.py
!important.py
```

### 問題4: フォルダが空で追跡されない

#### **症状**
```bash
# 空のフォルダがGitに追加されない
mkdir logs
git add logs/
# 何も起こらない
```

#### **解決**
```bash
# .gitkeepファイルを作成
touch logs/.gitkeep
git add logs/.gitkeep
```

---

## 🎯 実践演習

### 演習1: 基本的な.gitignore作成

以下のプロジェクト構成で適切な`.gitignore`を作成してください：

```
my-web-app/
├── app.py
├── requirements.txt  
├── __pycache__/
│   └── app.cpython-39.pyc
├── venv/
├── .env (DATABASE_PASSWORD=secret)
├── .vscode/
│   └── settings.json
├── temp_notes.txt
├── logs/
│   └── debug.log
└── .DS_Store
```

<details>
<summary>💡 解答例を見る</summary>

```gitignore
# Python関連
__pycache__/
*.py[cod]
venv/

# 機密情報
.env

# IDE
.vscode/

# 個人ファイル
temp_notes.txt

# ログファイル
logs/
*.log

# OS
.DS_Store
Thumbs.db
```

</details>

### 演習2: トラブル解決

`.gitignore`に`*.log`を追加したのに、`debug.log`がまだ`git status`に表示されています。なぜでしょうか？どう解決しますか？

<details>
<summary>💡 解答を見る</summary>

**原因**: `debug.log`がすでにGitで追跡されている

**解決手順**:
```bash
# 1. 追跡から外す
git rm --cached debug.log

# 2. コミット
git commit -m "Remove debug.log from tracking"

# 3. 確認
git status  # debug.logが表示されなくなる
```

</details>

---

## 📚 まとめ

### 重要ポイント

1. **📝 .gitignoreは早めに設定**
   - プロジェクト開始時に作成
   - テンプレートを活用

2. **🔐 機密情報は絶対に除外**
   - パスワード、APIキー
   - 個人情報、設定ファイル

3. **🤖 自動生成ファイルは除外**
   - キャッシュ、ビルド結果
   - 仮想環境、依存関係

4. **👥 チーム開発での配慮**
   - 個人設定は除外
   - 共通ルールの策定

5. **🚨 トラブル対応**
   - `git rm --cached`の使用
   - `git check-ignore`での確認

### 次のステップ

- **実際のプロジェクトで.gitignoreを作成**
- **GitHubのテンプレートを試す**
- **チーム開発でのルール策定**

**`.gitignore`を適切に使うことで、クリーンで安全なGitリポジトリを維持できます！**

---

## 🔗 関連リンク

- **前の章**: [12_推奨_バージョン管理って何？](./12_推奨_バージョン管理って何？.md)
- **関連章**: [08_応用_パッケージ管理の概念](./08_応用_パッケージ管理の概念.md)
- **公式ドキュメント**: [Git - gitignore Documentation](https://git-scm.com/docs/gitignore)
- **テンプレート集**: [GitHub .gitignore Templates](https://github.com/github/gitignore)